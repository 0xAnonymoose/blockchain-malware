---
version: 1
revision: 1
malwareName: "Rugpull.aifjoanvls"
malwareTags:
  - "backdoor.mint"
blockchain:
  id: 56
  name: "BSC"

signatures:
  - signatureType: "source"
    keyword: "setSwapAndLiquifyByLimitOnIy"
    note: "Backdoored function name"

  - signatureType: "source"
    keyword: "aifjoanvls"
    note: "Backdoored permission map name"
    
  - signatureType: "transaction"
    note: "Funder wallet creates puppet deployers"
    filter:
      from: "0xd93408ffe8027430bcf7b4151d0c036fd614de33"
      value: "2200000000000000000"
    outputSchema: "puppet"
    outputMap:
      puppetCreated: "to"
      puppetMaster: "from"

  - signatureType: "transaction"
    note: "Rugpull contract backdoor mint"
    filter:
      input:
        startsWith: "0xc7e53f8c"
    outputSchema: "backdoorMint"
    outputMap:
      malwareContract: "to"
      malwareDeployer: "from"
                
  - signatureType: "contract"
    note: "Rugpull contract runtime check"
    filter:
      code:
        length: 37344
        checksums:
        - offset: 5280
          end: 9792
          sha256: "cec2d3d3db4cba785a62610ed9142813ef8ec39af99e879772805b17cf22bdb8"
        - offset: 23296
          end: 29536
          sha256: "dafa881d9803cee2d9b81b68e95780165950d1ddf1e7245f74c7e1089031a95b"
    outputSchema: "malware"

  - signatureType: "contract"
    note: "Rugpull contract runtime check"
    filter:
      code:
        length: 37430
        checksums:
        - offset: 0
          end: 37328
          sha256: "672035eec7631f9f4978fb283cc5ffe808acd23517ab1f4aa6959c55e1c35dab"
    outputSchema: "malware"

samples:
  KibaShitama.sol:
    sampleType: "solidity"
    modified: false
    uri: "https://bscscan.com/address/0x7fa1a7b22c9b45a1f3c7f354f797a9294f352816#code"
    length: 28178
    contract: "0x7fa1a7b22c9b45a1f3c7f354f797a9294f352816"    
    sha256: "f35f1c239fa58c5bd8262129254745d4cbd6ae64e6b459161b8b135f311ec78e"
              
annotations:
  - sample: "KibaShitama.sol"
    lines: [[7, 8]]
    text: "Not technically a lie, but practically the deployer can mint more any time."
  - sample: "KibaShitama.sol"
    lines: [399, [475, 476]]
    text: "The taxExempt storage has been renamed aifjoanvls in this malware (hence the name) and is used as a permission-gate for the unlimited mint backdoor.  Note that deployer grants themselves this permission in the constructor"
  - sample: "KibaShitama.sol"
    lines: [[501-503]]
    text: "The balances storage has been renamed _KsawBAwsl in this malware"
  - sample: "KibaShitama.sol"
    annotationType: "backdoor.mint"
    lines: [[676,679]]    
    text: "setSwapAndLiquifyByLimitOnIy (note the capital I in place of L) is the backdoor mint function used by attacker to Rugpull.  If the caller has permission (see note above, granted at mint time in the constuctor) this function will backdoor the given balance into the given wallet."
  
  
