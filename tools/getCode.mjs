import {readFileSync, writeFileSync} from 'fs';
import Web3 from 'web3';

const web3 = new Web3("https://bsc-dataseed1.binance.org");
const argv = process.argv;

if (argv.length < 3) {
  console.log('Usage: node getCode.mjs <contract_address>');
} else {
    const arg = argv[2];
    let addrs = [arg];
    
    if (arg.substring(0,1) == '@') {
      let data = readFileSync( arg.substring(1), 'utf-8' );
      addrs = data.split('\n');
    }
    
    for (let addr of addrs) {
        await web3.eth.getCode( addr ).then( (r)=>{  writeFileSync( addr+'.hex', r); console.log('Saved '+addr+'.hex');  } );
    }
}
